services:
  backend:
    container_name: study-buddy-backend-dev
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    command: poetry run uvicorn app.main:app --host 0.0.0.0 --port ${APP_PORT}
    ports:
      - "${APP_PORT}:${APP_PORT}"         # FastAPI app port
      - "${DEBUG_PORT}:${DEBUG_PORT}"     # VSCode debugger port (e.g., 5678)
    volumes:
      - ./backend:/app                    # Mount source code
      - poetry-cache:/root/.cache/pypoetry
      - pip-cache:/root/.cache/pip
    env_file:
      - ./backend/.env
    extra_hosts:
      - "host.docker.internal:host-gateway"

volumes:
  poetry-cache:
  pip-cache:
